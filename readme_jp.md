# Si4063 2m transmitter for Raspi

RaspberryPiと拡張基板（si4063 2m radio hat、自作、hatディレクトリ参照）で144Mhz帯で変調波を送信します．

・周波数は144～146MHzで設定可能です

・最大出力は0.1W（20dBm）で１２８段階で設定可能です

・CW(Continuous wave)、OOK、FSKの変調が可能です

・アンテナを付けて実際に電波を発射する場合はアマチュア無線の免許が必要です

・動作させるときはSMA端子（J2:RF出力端子）は必ず終端するなどしてください．さもないと壊れるかもしれません．

# 動作確認した環境
Raspi3B+　Raspberry Pi OS(bookworm)

pigpioのインストールが必要です．

# HATの構成と動作
タイトルにあるようにSilicon Labs社のSi4063-Cを用いています．

SPIはRaspiから制御しますがGPIO経由で自前で制御していますのでRaspiのSPIの設定は不要です．
もし、SPI0が有効になっている場合は無効にしてください．（GPIOとして使います）

Si4063はDirect Async Modeで動きます．

送信データはRaspiのGPIOからSi4063のGPIOで受け渡しされて、FIFOを経由しないでそのままのタイミングで送信されます．

送信している間はインジケータとしてLED2が点灯します．

# ソフトウェア
## si4063.py

コマンドラインから実行すると簡単な送信動作ができます．

````
$ python si4063.py
````

引数がない場合は簡単なヘルプを表示して終了します．
引数は以下のものがあります．

### -c (seconds)
無変調波を指定秒数だけ送信します．（無指定の場合は１０秒）
出力の大きさやスプリアスなどの測定用です．

送信周波数はデフォルトで144.05MHzです．（変数で設定可能）

### -f
FSK変調波を約10秒送信します．

データは10101010.... です．
データレートは約1000bpsです．
周波数偏移は8kHzです．
これらはパラメータで設定可能です．

データレートはICの仕様では1Mbpsまで対応していますので
正確なボーレートをタイマー割込みなどで作成すれば高速な通信が可能と思います．(pythonではちょっとむつかしい...)

### -o
OOK変調波を約10秒間送信します．

データは10101010....  です．
データレートは約1000bpsです．
FSKと同様にパラメータで設定可能です．

なお、si4063const.pyはパラメータファイルです．同じディレクトリにおいてください．

## 主なメソッド
si4063.pyはモジュールとしてpythonプログラムにimport して使うことができます．（こっちが本来の使い方）

主なメソッドを次に示します．

### reset()
si4063をリセットします．
電源投入後に一回実行します．

### power_up()
si4063を起動（boot）します．reset → power_upの順で使います．

### part_info()
チップ番号を取得します．
```
count, chip_no = si4063.part_info()
```
count: 取得にかかった回数(通常は一回で読めますが回数が多い場合はなにかが起きています)

chip_no: チップ番号（0x4063）

### set_radio_frequency(frequency)
送信周波数を設定します．単位はHzです．
シンセサイザーの分解能により2Hz程度のずれがありえます．

### set_modem_freq_offset(freq_offset)
送信周波数にオフセットを与えます．
クリスタルの発振周波数の誤差を補正するものですが変調方式により値は異なるようです．
単位はHzです．

### set_pa_pwr_lvl(pwr_lvl)
送信パワーを設定します．0x0～0x7fの値を指定します．
設定値と出力のグラフはsi4063-CのデータシートのFigure8 にあります．

### setup(mod_type, freq_dev)
ICのレジスタ設定を行うと共に変調方式を設定します

MOD_TYPE_OOK,MOD_TYPE_FSK,MOD_TYPE_CWのいずれかを指定します．

FSKの場合は周波数偏移をHzで指定できます．

### start_tx()
送信を開始します．

### stop_tx()
送信を停止します．内部状態（state）はREADYです．

### tx_data(data)
送信データdata(0|1)をセットします．
送信状態では即時に反映されます．

### get_adc_reading()
ICの電源電圧と温度を測定します．

````
temp, voltage = si4063.get_adc_reading()
````

単位は℃、Vです．

## radio_morse.py

モールス符号を送信するサンプルアプリです．
si4063.pyをimportして使います．

コマンドラインで引数にwpmの数字を指定して起動します．

````
$ python radio_morse.py wpm
````

文字列の入力を求められるので英数の文字列を入力してください．

モールス符号を’．’と’－’でコンソールに表示するとともに送信します．

なお、wpmは５から３０までに制限しています．

Have A Fun!
